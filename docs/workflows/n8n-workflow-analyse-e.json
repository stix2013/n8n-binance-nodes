{
  "name": "Binance Future Analysis",
  "nodes": [
    {
      "parameters": {
        "chatId": "={{ $('Translate to Symbol').item.json.chatId }}",
        "text": "=ðŸ” Analysing {{ $json.symbol }}...\n\nTimeframes: {{ $json.intervals.join(', ') }}\nProcessing market data and indicators. Please wait.",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        0,
        -160
      ],
      "id": "ad29e1be-b0dc-4ee0-a0b2-b0b7b02f26f2",
      "name": "Notify Analysis Start",
      "webhookId": "0c768786-24a4-4aa5-81f3-8d8213ea7895",
      "credentials": {
        "telegramApi": {
          "id": "O5JL1UG87JJ1GySx",
          "name": "stix_crypto_freak_bot"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "toolDescription": "Given the list of articles about crypto coin like BTC, ETH, SOL, etc. The articles are with their sentiment.\n",
        "url": "=http://api:8000/api/news/sentiment/{{ $('Translate to Symbol').item.json.coin }}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.4,
      "position": [
        1120,
        608
      ],
      "id": "b6e26ade-6678-4072-8417-43306e41a4a5",
      "name": "News Sentiment"
    },
    {
      "parameters": {
        "conversionOptions": {
          "format": "auto"
        },
        "characterFiltering": {},
        "outputOptions": {
          "outputMode": "binary"
        }
      },
      "type": "CUSTOM.markdownSaver",
      "typeVersion": 1,
      "position": [
        1584,
        384
      ],
      "id": "e2a9902c-eb97-49c0-bd3d-1c5893e036ce",
      "name": "Markdown Binary"
    },
    {
      "parameters": {
        "operation": "write",
        "fileName": "=/home/node/analyse/AI-{{ $('Translate to Symbol').item.json.symbol }}-{{ $now.format('yyyyMMddHHmm') }}.md",
        "dataPropertyName": "=data",
        "options": {}
      },
      "type": "n8n-nodes-base.readWriteFile",
      "typeVersion": 1.1,
      "position": [
        1808,
        288
      ],
      "id": "57dd4fb1-f0a6-40de-88c5-060a69b26923",
      "name": "Write to docs/analyse",
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "availableInChat": true,
        "agentName": "Crypto Analyse",
        "agentDescription": "This is day trader expert for crypto",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "typeVersion": 1.4,
      "position": [
        -448,
        224
      ],
      "id": "0721980d-4bf6-4006-af91-fbb093605833",
      "name": "When chat message received",
      "webhookId": "5d8f37da-b2bf-4901-b817-8ca02788f59f"
    },
    {
      "parameters": {
        "jsCode": "const raw = ($input.first().json.chatInput || $input.first().json.message?.text || '').trim();\nif (!raw) throw new Error('No coin symbol provided. Send a symbol like BTC, ETH, or SOL.');\n\n// Strip common suffixes if user already typed full pair\nconst coin = raw.toUpperCase().replace(/USDT$/, '').replace(/[^A-Z0-9]/g, '');\nif (!coin) throw new Error('Invalid symbol. Send a coin like BTC, ETH, or SOL.');\n\nconst symbol = coin + 'USDT';\nconst chatId = $input.first().json.message?.chat?.id || '5572228344';\nconst limit = 500;\n\nconst intervals = [\n  '15m', // for 15 minutes timeframe\n  '1h', // for 1 hour timeframe\n  '4h', // for 4 hours timeframe\n];\n\nreturn [{\n    coin,\n    symbol,\n    limit,\n    intervals,\n    chatId\n  }];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -224,
        128
      ],
      "id": "a7026d7d-d328-4274-842b-222d40558467",
      "name": "Translate to Symbol"
    },
    {
      "parameters": {
        "numberInputs": 3
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        448,
        208
      ],
      "id": "c022d3e3-40cc-4df7-826e-3e21ffe5443e",
      "name": "Merge Indicators"
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "destinationFieldName": "dataIndicators",
        "options": {}
      },
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        896,
        224
      ],
      "id": "5a465049-c765-4012-b597-3a043aa23d47",
      "name": "Aggregate"
    },
    {
      "parameters": {
        "updates": [
          "message"
        ],
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegramTrigger",
      "typeVersion": 1.2,
      "position": [
        -448,
        32
      ],
      "id": "7e816fc9-71ad-44ab-9aa1-b8cbeca97a8f",
      "name": "My Telegram Channel",
      "webhookId": "1474d42e-9084-48ef-ac45-a4b21168d942",
      "executeOnce": false,
      "credentials": {
        "telegramApi": {
          "id": "O5JL1UG87JJ1GySx",
          "name": "stix_crypto_freak_bot"
        }
      }
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "glm-5",
          "mode": "list",
          "cachedResultName": "glm-5"
        },
        "messages": {
          "values": [
            {
              "content": "=## INPUT DATA\n**Symbol:** {{ $json.dataIndicators[0].symbol }}\n\n---\n\n### Timeframe 1 ({{ $json.dataIndicators[0].interval }}) - [Short-term/Entry Timing]\n** RSI:**\n- Value: {{ $json.dataIndicators[0].rsi.value }}\n- Signal: {{ $json.dataIndicators[0].rsi.signal }}\n\n** MACD:**\n- Line: {{ $json.dataIndicators[0].macd.macd_line }}\n- Signal Line: {{ $json.dataIndicators[0].macd.signal_line }}\n- Histogram: {{ $json.dataIndicators[0].macd.histogram }}\n- Signal Type: {{ $json.dataIndicators[0].macd.signal_type }}\n- Crossover: {{ $json.dataIndicators[0].macd.crossover }}\n\n** SMA:**\n- SMA 10: {{ $json.dataIndicators[0].sma.sma_10 }}\n- SMA 20: {{ $json.dataIndicators[0].sma.sma_20 }}\n- SMA 50: {{ $json.dataIndicators[0].sma.sma_50 }}\n- Signal: {{ $json.dataIndicators[0].sma.signal }}\n\n---\n\n### Timeframe 2 ({{ $json.dataIndicators[1].interval }}) - [Medium-term/Trend Direction]\n** RSI:**\n- Value: {{ $json.dataIndicators[1].rsi.value }}\n- Signal: {{ $json.dataIndicators[1].rsi.signal }}\n\n** MACD:**\n- Line: {{ $json.dataIndicators[1].macd.macd_line }}\n- Signal Line: {{ $json.dataIndicators[1].macd.signal_line }}\n- Histogram: {{ $json.dataIndicators[1].macd.histogram }}\n- Signal Type: {{ $json.dataIndicators[1].macd.signal_type }}\n- Crossover: {{ $json.dataIndicators[1].macd.crossover }}\n\n** SMA:**\n- SMA 20: {{ $json.dataIndicators[1].sma.sma_20 }}\n- SMA 50: {{ $json.dataIndicators[1].sma.sma_50 }}\n- SMA 200: {{ $json.dataIndicators[1].sma.sma_200 }}\n- Signal: {{ $json.dataIndicators[1].sma.signal }}\n\n---\n\n### Timeframe 3 ({{ $json.dataIndicators[2].interval }}) - [Long-term/Market Bias]\n** RSI:**\n- Value: {{ $json.dataIndicators[2].rsi.value }}\n- Signal: {{ $json.dataIndicators[2].rsi.signal }}\n\n** MACD:**\n- Line: {{ $json.dataIndicators[2].macd.macd_line }}\n- Signal Line: {{ $json.dataIndicators[2].macd.signal_line }}\n- Histogram: {{ $json.dataIndicators[2].macd.histogram }}\n- Signal Type: {{ $json.dataIndicators[2].macd.signal_type }}\n- Crossover: {{ $json.dataIndicators[2].macd.crossover }}\n\n** SMA:**\n- SMA 20: {{ $json.dataIndicators[2].sma.sma_20 }}\n- SMA 50: {{ $json.dataIndicators[2].sma.sma_50 }}\n- SMA 200: {{ $json.dataIndicators[2].sma.sma_200 }}\n- Signal: {{ $json.dataIndicators[2].sma.signal }}\n\n---\n\n### 5. OUTPUT FORMAT\n\nProvide your analysis in this structure:\n\nAnalyse for {{ $json.dataIndicators[0].symbol }} at {{ $now.format('yyyy-MM-dd HH:mm')}}\n\n**ðŸ“Š MARKET STRUCTURE:** [Bullish/Bearish/Neutral/Mixed with confidence %]\n\n**ðŸŽ¯ TRADING RECOMMENDATION:** \n- Action: [WAIT / LONG / SHORT / CLOSE POSITION]\n- Entry Zone: [Price range or \"Wait for trigger\"]\n- Stop Loss: [Price or percentage]\n- Target 1 (2:1 R:R): [Price]\n- Target 2 (3:1 R:R): [Price]\n\n**ðŸ“ˆ SIGNAL BREAKDOWN:**\n- Confluence Score: [Strong/Moderate/Weak]\n- Key Bullish Factors: [List]\n- Key Bearish Factors: [List]\n- Primary Risk: [Main concern]\n\n**âš ï¸ RISK WARNING:**\n[Specific conditions that could invalidate the setup or increase risk]\n\n**ðŸ’¡ CONTEXT NOTES:**\n[Crypto-specific considerations: volatility, 24/7 market, news sensitivity, volume confirmation needs]\n\n---\n\n## IMPORTANT GUIDELINES\n\n1. **No Trade is Better Than a Bad Trade:** If signals conflict or confluence is weak, recommend WAITING\n2. **Timeframe Hierarchy:** Respect the trend of the higher timeframe; use lower timeframes only for entry timing\n3. **Crypto Volatility:** Account for 24/7 trading, sudden volatility spikes, and news-driven moves\n4. **Confirmation Required:** Never recommend a trade based on a single indicator; require at least 2-3 confirming factors\n5. **Dynamic Adaptation:** If RSI is extremely overbought (>75) or oversold (<25), prioritize mean reversion over trend following"
            }
          ]
        },
        "options": {
          "system": "=You are an expert cryptocurrency day trader with deep expertise in technical analysis, risk management, and multi-timeframe strategy. Analyze the following data for {{ $json.dataIndicators[0].symbol }} and provide actionable trading insights. There are tools available:\n1. Tool to get the news sentiment for {{ $json.dataIndicators[0].symbol }} from the `News Sentiment` tool. \n2. Tool to get the current price in USDT.\n3. Tool to get klines or candle-sticks with interval 1 minute. You can limit how much data that you will fetch.",
          "temperature": 0.1
        }
      },
      "type": "@n8n/n8n-nodes-langchain.ollama",
      "typeVersion": 1,
      "position": [
        1184,
        384
      ],
      "id": "4d16c57a-e0b9-445c-8cbd-69c435fa17f6",
      "name": "Message a model",
      "credentials": {
        "ollamaApi": {
          "id": "URvt83r3fqd9q5Z7",
          "name": "Ollama account"
        }
      }
    },
    {
      "parameters": {
        "operation": "sendDocument",
        "chatId": "={{ $('Translate to Symbol').item.json.chatId }}",
        "binaryData": true,
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        1808,
        480
      ],
      "id": "4fd04aed-20ea-4165-a60f-527993e68fda",
      "name": "Send a document",
      "webhookId": "68cabebe-d0d8-41b1-8719-f51a48bbd02b",
      "alwaysOutputData": true,
      "credentials": {
        "telegramApi": {
          "id": "O5JL1UG87JJ1GySx",
          "name": "stix_crypto_freak_bot"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "chatId": "={{ $('Translate to Symbol').item.json.chatId }}",
        "text": "Calculate Indicators finished",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        1248,
        80
      ],
      "id": "49e9969b-cb8d-42e4-b931-e312670af235",
      "name": "Send a text message",
      "webhookId": "058cd607-dd62-4cb4-80c4-7fd0459ac9a9",
      "credentials": {
        "telegramApi": {
          "id": "O5JL1UG87JJ1GySx",
          "name": "stix_crypto_freak_bot"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "toolDescription": "Fetch candlestick/kline data from Binance Spot or USD-M Futures API.\nExample Input: BTCUSDT, ETHUSDT, etc.",
        "apiSource": "direct",
        "marketType": "futures",
        "symbol": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Symbol', ``, 'string') }}",
        "interval": "1m",
        "limit": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Limit', ``, 'number') }}"
      },
      "type": "CUSTOM.binanceKlineTool",
      "typeVersion": 1,
      "position": [
        1248,
        608
      ],
      "id": "a618636b-3e5b-45b9-9406-9c781dc419f4",
      "name": "Klines Tool",
      "credentials": {
        "binanceApi": {
          "id": "tmVGRcPSpJIYsaeS",
          "name": "Binance account"
        }
      }
    },
    {
      "parameters": {
        "toolDescription": "Fetch current price of a cryto symbol (example: BTCUSDT, ETHUSDT, etc.). \n\nExample Output with input ETHUSDT:\n\n [\n  {\n    \"symbol\": \"ETHUSDT\",\n    \"marketType\": \"futures\",\n    \"dataType\": \"markPriceKline\",\n    \"interval\": \"1m\",\n    \"limit\": 1,\n    \"currentPrice\": \"1980.80000000\",\n    \"klineCount\": 1,\n    \"klines\": [\n      {\n        \"openTime\": 1771413360000,\n        \"open\": \"1981.56000000\",\n        \"high\": \"1981.95000000\",\n        \"low\": \"1980.44558140\",\n        \"close\": \"1980.80000000\",\n        \"volume\": \"0\",\n        \"closeTime\": 1771413419999,\n        \"quoteVolume\": \"0\",\n        \"trades\": 32,\n        \"takerBuyBaseVolume\": \"0\",\n        \"takerBuyQuoteVolume\": \"0\"\n      }\n    ],\n    \"fetchedAt\": \"2026-02-18T11:16:41.224Z\"\n  }\n]\n\nAnd the curren price is 1980.80000000",
        "apiSource": "direct",
        "marketType": "futures",
        "symbol": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Symbol', ``, 'string') }}",
        "interval": "1m",
        "limit": 1
      },
      "type": "CUSTOM.binanceKlineTool",
      "typeVersion": 1,
      "position": [
        1376,
        608
      ],
      "id": "fda781e8-3020-4071-9100-8100374efd22",
      "name": "Current Price",
      "credentials": {
        "binanceApi": {
          "id": "tmVGRcPSpJIYsaeS",
          "name": "Binance account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const order = ['15m', '1h', '4h'];\nconst items = $input.all();\nitems.sort((a, b) => order.indexOf(a.json.interval) - order.indexOf(b.json.interval));\nreturn items;"
      },
      "id": "dcf56e24-f8f5-40f1-8444-aabe1a15a616",
      "name": "Sort by Interval",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        672,
        224
      ]
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "1X1ODf4tA0Vi8SsT",
          "mode": "list",
          "cachedResultUrl": "/workflow/1X1ODf4tA0Vi8SsT",
          "cachedResultName": "Sub-workflow: Binance Kline Analyze"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {},
          "matchingColumns": [],
          "schema": [],
          "attemptToConvertTypes": false,
          "convertFieldsToString": true
        },
        "options": {}
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.3,
      "position": [
        224,
        32
      ],
      "id": "9e509ebf-7393-46ec-900c-633b5f1f0636",
      "name": "Analyze 15m"
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "1X1ODf4tA0Vi8SsT",
          "mode": "list",
          "cachedResultUrl": "/workflow/1X1ODf4tA0Vi8SsT",
          "cachedResultName": "Sub-workflow: Binance Kline Analyze"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {},
          "matchingColumns": [],
          "schema": [],
          "attemptToConvertTypes": false,
          "convertFieldsToString": true
        },
        "options": {}
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.3,
      "position": [
        224,
        224
      ],
      "id": "3f825469-ffb0-4880-8f4c-49096ab88bd8",
      "name": "Analyze 1h",
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "1X1ODf4tA0Vi8SsT",
          "mode": "list",
          "cachedResultUrl": "/workflow/1X1ODf4tA0Vi8SsT",
          "cachedResultName": "Sub-workflow: Binance Kline Analyze"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {},
          "matchingColumns": [],
          "schema": [],
          "attemptToConvertTypes": false,
          "convertFieldsToString": true
        },
        "options": {}
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.3,
      "position": [
        224,
        416
      ],
      "id": "0f537c59-e6ae-40f6-912b-bb02a3d653f2",
      "name": "Analyze 4h",
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "jsCode": "return [{\n  coin: $input.first().json.coin,\n  symbol: $input.first().json.symbol,\n  limit: $input.first().json.limit,\n  interval: $input.first().json.intervals[0]\n}]"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        0,
        32
      ],
      "id": "d3e99083-13da-4458-b0fd-45e3795e6a04",
      "name": "Interval 15m"
    },
    {
      "parameters": {
        "jsCode": "return [{\n  coin: $input.first().json.coin,\n  symbol: $input.first().json.symbol,\n  limit: $input.first().json.limit,\n  interval: $input.first().json.intervals[2]\n}]"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        0,
        416
      ],
      "id": "fc804b6f-f491-47ad-9d28-e57564a9141e",
      "name": "Interval 4h"
    },
    {
      "parameters": {
        "jsCode": "return [{\n  coin: $input.first().json.coin,\n  symbol: $input.first().json.symbol,\n  limit: $input.first().json.limit,\n  interval: $input.first().json.intervals[1]\n}]"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        0,
        224
      ],
      "id": "ae42e6ca-3416-47b2-beb9-45b065b2956f",
      "name": "Interval 1h"
    }
  ],
  "pinData": {},
  "connections": {
    "News Sentiment": {
      "ai_tool": [
        [
          {
            "node": "Message a model",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Markdown Binary": {
      "main": [
        [
          {
            "node": "Write to docs/analyse",
            "type": "main",
            "index": 0
          },
          {
            "node": "Send a document",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "When chat message received": {
      "main": [
        [
          {
            "node": "Translate to Symbol",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Translate to Symbol": {
      "main": [
        [
          {
            "node": "Interval 15m",
            "type": "main",
            "index": 0
          },
          {
            "node": "Interval 1h",
            "type": "main",
            "index": 0
          },
          {
            "node": "Notify Analysis Start",
            "type": "main",
            "index": 0
          },
          {
            "node": "Interval 4h",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge Indicators": {
      "main": [
        [
          {
            "node": "Sort by Interval",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate": {
      "main": [
        [
          {
            "node": "Send a text message",
            "type": "main",
            "index": 0
          },
          {
            "node": "Message a model",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "My Telegram Channel": {
      "main": [
        [
          {
            "node": "Translate to Symbol",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Message a model": {
      "main": [
        [
          {
            "node": "Markdown Binary",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Klines Tool": {
      "ai_tool": [
        [
          {
            "node": "Message a model",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Current Price": {
      "ai_tool": [
        [
          {
            "node": "Message a model",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Sort by Interval": {
      "main": [
        [
          {
            "node": "Aggregate",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Analyze 15m": {
      "main": [
        [
          {
            "node": "Merge Indicators",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Analyze 1h": {
      "main": [
        [
          {
            "node": "Merge Indicators",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Analyze 4h": {
      "main": [
        [
          {
            "node": "Merge Indicators",
            "type": "main",
            "index": 2
          }
        ]
      ]
    },
    "Interval 15m": {
      "main": [
        [
          {
            "node": "Analyze 15m",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Interval 4h": {
      "main": [
        [
          {
            "node": "Analyze 4h",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Interval 1h": {
      "main": [
        [
          {
            "node": "Analyze 1h",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1",
    "binaryMode": "separate",
    "availableInMCP": false
  },
  "versionId": "bd4af902-c0eb-44ab-9210-9dcf01e46f3a",
  "meta": {
    "instanceId": "c5132ea42f91439834dd110c2ce2f5a137182faaae992ba119ae691d81f22581"
  },
  "id": "U9TjbJahvt3E4XQn",
  "tags": [
    {
      "updatedAt": "2025-12-23T03:07:33.206Z",
      "createdAt": "2025-12-23T03:07:33.206Z",
      "id": "060QEUlc6EGuPlso",
      "name": "fetch"
    },
    {
      "updatedAt": "2025-12-12T09:00:55.594Z",
      "createdAt": "2025-12-12T09:00:55.594Z",
      "id": "4ykO1QsLPSkpVsfq",
      "name": "crypto"
    },
    {
      "updatedAt": "2025-12-12T09:00:43.685Z",
      "createdAt": "2025-12-12T09:00:43.685Z",
      "id": "A7qGk2uBcD5zKvhs",
      "name": "analysis"
    }
  ]
}